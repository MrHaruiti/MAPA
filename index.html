<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Painel de Voos - Aeroporto Hub Completo</title>
  <style>
    /* Reset e estilos base */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      margin-left: 360px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
      background: #e8f0fe;
      color: #222;
    }
    #painel {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 100;
      width: 360px;
      background: #111;
      color: #fff;
      padding: 15px;
      height: 100vh;
      overflow-y: auto;
      box-shadow: inset -3px 0 10px rgba(0,0,0,0.7);
    }
    #painel h2 {
      margin-top: 0;
      border-bottom: 1px solid #444;
      padding-bottom: 10px;
      font-weight: 600;
      font-size: 1.5em;
    }
    #aeroporto {
      flex: 1;
      background: linear-gradient(180deg, #9cc5e8 0%, #4a7ab7 100%);
      position: relative;
      overflow: auto;
      padding: 40px 20px;
      user-select: none;
      font-size: 14px;
      color: #222;
      min-width: 1560px;
      min-height: 1300px; /* Aumentei um pouco para caber os terminais maiores e taxiways */
    }
    /* Pista base - largas e longas */
    .pista {
      position: absolute;
      background: #555;
      border-radius: 14px;
      box-shadow: inset 0 0 18px #333;
      border: 2px solid #333;
      transition: background 0.3s ease;
      z-index: 10;
    }
    /* Taxiways */
    .taxiway-horizontal, .taxiway-vertical {
      position: absolute;
      background: #888;
      border-radius: 8px;
      box-shadow: inset 0 0 10px #666;
      border: 1.5px solid #555;
      z-index: 9;
    }
    .taxiway-horizontal {
      height: 28px;
    }
    .taxiway-vertical {
      width: 28px;
    }
    /* Terminais organizados lado a lado em 2 linhas, com altura aumentada */
    .terminal {
      position: absolute;
      width: 260px;
      height: 600px; /* altura para acomodar 36 posições ao redor */
      background-color: rgba(255 255 255 / 0.98);
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.18);
      border: 1px solid #888;
      padding: 12px 8px 12px 12px;
      box-sizing: border-box;
      user-select: none;
      z-index: 20;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      overflow-y: auto;
      position: relative;
    }
    .terminal-title {
      font-weight: 700;
      font-size: 16px;
      padding-bottom: 6px;
      border-bottom: 2px solid #777;
      margin-bottom: 10px;
      user-select: none;
      text-align: center;
      position: sticky;
      top: 0;
      background: rgba(255 255 255 / 0.98);
      z-index: 21;
    }
    /* Posições distribuídas ao redor do terminal */
    .posicoes-container {
      flex: 1;
      position: relative;
      width: 260px;
      height: 600px;
      pointer-events: none;
    }
    /* Cada posição */
    .posicao {
      position: absolute;
      width: 38px;
      height: 30px;
      background: #ddd;
      border: 2px solid #999;
      border-radius: 6px;
      line-height: 30px;
      font-weight: 700;
      color: #555;
      cursor: default;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      user-select: none;
      padding-left: 8px;
      padding-right: 8px;
      box-sizing: border-box;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      pointer-events: auto;
      text-align: center;
    }
    .posicao.livre {
      background: #cfc;
      border-color: #484;
      cursor: pointer;
    }
    .posicao.livre:hover {
      background: #9f9;
      border-color: #282;
    }
    .posicao-bottom {
      bottom: 5px;
    }
    .posicao-top {
      top: 5px;
    }
    .posicao-right {
      right: 5px;
      width: 30px;
      height: 38px;
      line-height: 38px;
      padding: 0;
    }
    .posicao-left {
      left: 5px;
      width: 30px;
      height: 38px;
      line-height: 38px;
      padding: 0;
    }
    /* Aeronaves */
    .aeronave {
      width: 34px;
      height: 34px;
      background: #1a73e8;
      color: white;
      font-weight: 700;
      font-size: 15px;
      text-align: center;
      line-height: 34px;
      border-radius: 8px;
      position: absolute;
      cursor: pointer;
      box-shadow: 0 0 11px #0a5;
      user-select: none;
      transition: background-color 0.3s ease;
      z-index: 30;
    }
    .aeronave[title]:hover {
      filter: brightness(1.3);
    }
    .tooltip {
      position: absolute;
      background: rgba(0,0,0,0.85);
      color: white;
      padding: 7px 12px;
      font-size: 13px;
      border-radius: 12px;
      display: none;
      pointer-events: none;
      z-index: 1000;
      max-width: 280px;
      white-space: normal;
    }
    .autorizar {
      background: #0a0;
      color: #fff;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      margin-top: 12px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 15px;
      transition: background-color 0.3s ease;
      width: 100%;
      box-sizing: border-box;
      user-select: none;
    }
    .autorizar:hover {
      background: #070;
    }
    .partida-lista, .aeronave-lista {
      background: #222;
      padding: 14px 18px;
      margin-bottom: 14px;
      border-radius: 12px;
      border: 1px solid #444;
      box-shadow: inset 0 0 12px #000;
      font-size: 15px;
    }
    .btn-trocar-posicao {
      position: absolute;
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 6px;
      cursor: pointer;
      background: #444;
      color: #fff;
      z-index: 31;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="painel">
    <h2>Chegadas Programadas</h2>
    <div id="chegadas"></div>
    <h2>Partidas Disponíveis</h2>
    <div id="partidas"></div>
  </div>
  <div id="aeroporto" tabindex="0">
    <!-- Pistas largas e longas -->
    <div id="pista1-pouso" class="pista" style="top: 40px; left: 100px; width: 1200px; height: 45px;" title="Pista 1 - Pouso"></div>
    <div id="pista1-decolagem" class="pista" style="top: 480px; left: 100px; width: 1200px; height: 45px;" title="Pista 1 - Decolagem"></div>
    <div id="pista2-pouso" class="pista" style="top: 650px; left: 100px; width: 1200px; height: 45px;" title="Pista 2 - Pouso"></div>
    <div id="pista2-decolagem" class="pista" style="top: 1090px; left: 100px; width: 1200px; height: 45px;" title="Pista 2 - Decolagem"></div>

    <!-- Taxiways amplas com comprimento igual às pistas -->
    <div id="taxiA" class="taxiway-horizontal" style="top: 100px; left: 100px; width: 1200px; height: 35px;" title="Taxiway A"></div>
    <div id="taxiB" class="taxiway-horizontal" style="top: 150px; left: 100px; width: 1200px; height: 35px;" title="Taxiway B"></div>
    <div id="taxiC" class="taxiway-horizontal" style="top: 440px; left: 100px; width: 1200px; height: 35px;" title="Taxiway C"></div>
    <div id="taxiD" class="taxiway-horizontal" style="top: 490px; left: 100px; width: 1200px; height: 35px;" title="Taxiway D"></div>

    <div id="taxiG" class="taxiway-horizontal" style="top: 710px; left: 100px; width: 1200px; height: 35px;" title="Taxiway G"></div>
    <div id="taxiH" class="taxiway-horizontal" style="top: 760px; left: 100px; width: 1200px; height: 35px;" title="Taxiway H"></div>
    <div id="taxiI" class="taxiway-horizontal" style="top: 1050px; left: 100px; width: 1200px; height: 35px;" title="Taxiway I"></div>
    <div id="taxiJ" class="taxiway-horizontal" style="top: 1100px; left: 100px; width: 1200px; height: 35px;" title="Taxiway J"></div>

    <!-- Terminais lado a lado, duas linhas -->
    <!-- Linha superior - TPS1 a TPS5 -->
    <div id="TPS1" class="terminal" style="top: 190px; left: 100px;" title="Terminal TPS1"></div>
    <div id="TPS2" class="terminal" style="top: 190px; left: 380px;" title="Terminal TPS2"></div>
    <div id="TPS3" class="terminal" style="top: 190px; left: 660px;" title="Terminal TPS3"></div>
    <div id="TPS4" class="terminal" style="top: 190px; left: 940px;" title="Terminal TPS4"></div>
    <div id="TPS5" class="terminal" style="top: 190px; left: 1220px;" title="Terminal TPS5"></div>

    <!-- Linha inferior - TPS6 a TPS10 -->
    <div id="TPS6" class="terminal" style="top: 860px; left: 100px;" title="Terminal TPS6"></div>
    <div id="TPS7" class="terminal" style="top: 860px; left: 380px;" title="Terminal TPS7"></div>
    <div id="TPS8" class="terminal" style="top: 860px; left: 660px;" title="Terminal TPS8"></div>
    <div id="TPS9" class="terminal" style="top: 860px; left: 940px;" title="Terminal TPS9"></div>
    <div id="TPS10" class="terminal" style="top: 860px; left: 1220px;" title="Terminal TPS10"></div>

    <div id="tooltip" class="tooltip"></div>
  </div>

<script>
  let chegadas = [], partidas = [];
  const chegadasDiv = document.getElementById("chegadas");
  const partidasDiv = document.getElementById("partidas");
  const aeroporto = document.getElementById("aeroporto");
  const tooltip = document.getElementById("tooltip");
  let currentTarget = null;
  const filasTaxi = {};

  const pontos = {
    pista1_fim: {x: 1280, y: 60},
    taxiA_inicio: {x: 1280, y: 100},
    taxiA_meio: {x: 700, y: 100},
    taxiB_descida: {x: 700, y: 150},
    entrada_TPS1: {x: 180, y: 280},
    entrada_TPS2: {x: 460, y: 280},
    entrada_TPS3: {x: 740, y: 280},
    entrada_TPS4: {x: 1020, y: 280},
    entrada_TPS5: {x: 1300, y: 280},

    pista1_decolagem_inicio: {x: 120, y: 520},
    taxiC_inicio: {x: 120, y: 470},
    taxiC_meio: {x: 700, y: 470},
    taxiD_descida: {x: 700, y: 520},
    entrada_TPS1_baixo: {x: 180, y: 920},
    entrada_TPS2_baixo: {x: 460, y: 920},
    entrada_TPS3_baixo: {x: 740, y: 920},
    entrada_TPS4_baixo: {x: 1020, y: 920},
    entrada_TPS5_baixo: {x: 1300, y: 920},

    pista2_fim: {x: 1280, y: 670},
    taxiG_inicio: {x: 1280, y: 710},
    taxiG_meio: {x: 700, y: 710},
    taxiH_descida: {x: 700, y: 760},
    entrada_TPS6: {x: 180, y: 910},
    entrada_TPS7: {x: 460, y: 910},
    entrada_TPS8: {x: 740, y: 910},
    entrada_TPS9: {x: 1020, y: 910},
    entrada_TPS10: {x: 1300, y: 910},

    pista2_decolagem_inicio: {x: 120, y: 1130},
    taxiI_inicio: {x: 120, y: 1080},
    taxiI_meio: {x: 700, y: 1080},
    taxiJ_descida: {x: 700, y: 1130},
    entrada_TPS6_baixo: {x: 180, y: 1170},
    entrada_TPS7_baixo: {x: 460, y: 1170},
    entrada_TPS8_baixo: {x: 740, y: 1170},
    entrada_TPS9_baixo: {x: 1020, y: 1170},
    entrada_TPS10_baixo: {x: 1300, y: 1170},
  };

  function seguirRota(el, pontosRota, callback) {
    if (pontosRota.length === 0) {
      if (callback) callback();
      return;
    }
    const ponto = pontos[pontosRota[0]];
    if (!ponto) {
      seguirRota(el, pontosRota.slice(1), callback);
      return;
    }
    moverSuave(el, ponto.x, ponto.y, () => seguirRota(el, pontosRota.slice(1), callback));
  }

  function moverSuave(el, destinoX, destinoY, callback) {
    clearInterval(el._intervalMover);
    el._intervalMover = setInterval(() => {
      const curX = parseFloat(el.style.left) || 0;
      const curY = parseFloat(el.style.top) || 0;
      const dx = destinoX - curX;
      const dy = destinoY - curY;
      const dist = Math.sqrt(dx*dx + dy*dy);
      const passo = 6;
      if(dist <= passo){
        el.style.left = destinoX + "px";
        el.style.top = destinoY + "px";
        clearInterval(el._intervalMover);
        if(callback) callback();
      } else {
        el.style.left = (curX + passo * dx / dist) + "px";
        el.style.top = (curY + passo * dy / dist) + "px";
      }
    }, 20);
  }

  function criarTerminais() {
    const terminaisIds = ["TPS1","TPS2","TPS3","TPS4","TPS5","TPS6","TPS7","TPS8","TPS9","TPS10"];
    terminaisIds.forEach(id => {
      const termDiv = document.getElementById(id);
      termDiv.innerHTML = "";
      const titulo = document.createElement("div");
      titulo.className = "terminal-title";
      titulo.textContent = id;
      termDiv.appendChild(titulo);
      const posicoesContainer = document.createElement("div");
      posicoesContainer.className = "posicoes-container";

      const largura = 260;
      const altura = 600;
      const gapHorizontal = (largura - 38) / 8; 
      const gapVertical = (altura - 38) / 8;

      for(let i=0; i<9; i++) {
        const pos = document.createElement("div");
        pos.className = "posicao livre posicao-bottom";
        pos.style.left = (5 + i * gapHorizontal) + "px";
        const posicaoNum = (parseInt(id.replace(/\D/g,"")))*100 + i + 1;
        pos.dataset.terminal = id;
        pos.dataset.codigo = posicaoNum;
        pos.title = posicaoNum.toString();
        pos.innerText = posicaoNum;
        posicoesContainer.appendChild(pos);
      }
      for(let i=0; i<9; i++) {
        const pos = document.createElement("div");
        pos.className = "posicao livre posicao-right";
        pos.style.top = (5 + i * gapVertical) + "px";
        const posicaoNum = (parseInt(id.replace(/\D/g,"")))*100 + 9 + i + 1;
        pos.dataset.terminal = id;
        pos.dataset.codigo = posicaoNum;
        pos.title = posicaoNum.toString();
        pos.innerText = posicaoNum;
        posicoesContainer.appendChild(pos);
      }
      for(let i=0; i<9; i++) {
        const pos = document.createElement("div");
        pos.className = "posicao livre posicao-top";
        pos.style.left = (5 + i * gapHorizontal) + "px";
        const posicaoNum = (parseInt(id.replace(/\D/g,"")))*100 + 18 + i + 1;
        pos.dataset.terminal = id;
        pos.dataset.codigo = posicaoNum;
        pos.title = posicaoNum.toString();
        pos.innerText = posicaoNum;
        posicoesContainer.appendChild(pos);
      }
      for(let i=0; i<9; i++) {
        const pos = document.createElement("div");
        pos.className = "posicao livre posicao-left";
        pos.style.top = (5 + i * gapVertical) + "px";
        const posicaoNum = (parseInt(id.replace(/\D/g,"")))*100 + 27 + i + 1;
        pos.dataset.terminal = id;
        pos.dataset.codigo = posicaoNum;
        pos.title = posicaoNum.toString();
        pos.innerText = posicaoNum;
        posicoesContainer.appendChild(pos);
      }
      
      termDiv.appendChild(posicoesContainer);
    });
  }

  function renderizarChegadas() {
    chegadasDiv.innerHTML = "";
    chegadas.filter(v => v.status === "Aguardando Autorizacao").forEach(voo => {
      const div = document.createElement("div");
      div.className = "aeronave-lista";
      div.innerHTML = `<strong>${voo.companhia} ${voo.voo}</strong><br>De: ${voo.cidade}<br>A/C: ${voo.aeronave}<br>Horário: ${voo.horario}<br>Status: ${voo.status}<br><button class="autorizar">Autorizar Pouso</button>`;
      div.querySelector("button").onclick = () => autorizarPouso(voo);
      chegadasDiv.appendChild(div);
    });
  }

  function renderizarPartidas() {
    partidasDiv.innerHTML = "";
    partidas.filter(v => v.status === "Aguardando Associacao").forEach(voo => {
      const div = document.createElement("div");
      div.className = "partida-lista";
      div.innerHTML = `<strong>${voo.companhia} ${voo.voo}</strong><br>Para: ${voo.cidade}<br>A/C: ${voo.aeronave}<br>Horário: ${voo.horario}<br>Status: ${voo.status}`;
      partidasDiv.appendChild(div);
    });
  }

  function autorizarPouso(voo) {
    voo.status = "Pousando";
    renderizarChegadas();

    const el = document.createElement("div");
    el.className = "aeronave";
    el.innerText = voo.voo;
    el.title = `${voo.companhia} ${voo.voo} - ${voo.cidade}`;
    el.style.top = "60px";
    el.style.left = "120px";
    el.dataset.info = JSON.stringify(voo);
    aeroporto.appendChild(el);

    const terminalDestino = (voo.terminal || "TPS1").toUpperCase();

    let rota = [];
    if (["TPS1","TPS2","TPS3","TPS4","TPS5"].includes(terminalDestino)) {
      rota = [
        "pista1_fim",
        "taxiA_inicio",
        "taxiA_meio",
        "taxiB_descida",
        "entrada_" + terminalDestino
      ];
    } else {
      rota = [
        "pista2_fim",
        "taxiG_inicio",
        "taxiG_meio",
        "taxiH_descida",
        "entrada_" + terminalDestino
      ];
    }

    seguirRota(el, rota, () => {
      voo.status = "Aguardando Alocacao";
      el.style.background = "orange";
      el.dataset.info = JSON.stringify(voo);
      escolherPosicaoTerminal(el, voo);
    });

    el.onclick = (evt) => { evt.stopPropagation(); selecionarPartida(el, voo); };
  }

  function escolherPosicaoTerminal(el, voo) {
    const popup = document.createElement("div");
    popup.style.position = "fixed";
    popup.style.top = "50%";
    popup.style.left = "50%";
    popup.style.transform = "translate(-50%, -50%)";
    popup.style.background = "#222";
    popup.style.color = "#fff";
    popup.style.padding = "22px";
    popup.style.border = "2px solid #555";
    popup.style.zIndex = 1001;
    popup.style.maxWidth = "350px";
    popup.style.borderRadius = "12px";
    popup.innerHTML = "<strong>Escolher posição livre para estacionar</strong><br><br>";

    const select = document.createElement("select");
    select.style.width = "100%";
    select.style.fontSize = "15px";

    const posicoesLivres = Array.from(document.querySelectorAll(".posicao.livre")).filter(pos => pos.dataset.terminal === (voo.terminal || "TPS1").toUpperCase());
    if (posicoesLivres.length === 0) {
      select.innerHTML = "<option disabled>Nenhuma posição livre disponível</option>";
    } else {
      posicoesLivres.forEach((pos) => {
        const opt = document.createElement("option");
        opt.value = pos.dataset.codigo;
        opt.textContent = pos.dataset.codigo + " (" + pos.dataset.terminal + ")";
        select.appendChild(opt);
      });
    }
    popup.appendChild(select);

    const btnConfirmar = document.createElement("button");
    btnConfirmar.textContent = "Confirmar";
    btnConfirmar.className = "autorizar";
    btnConfirmar.style.marginTop = "12px";
    btnConfirmar.onclick = () => {
      const codigoEscolhido = select.value;
      const pos = Array.from(document.querySelectorAll(".posicao.livre"))
        .find(p => p.dataset.codigo === codigoEscolhido);
      if (!pos) return;

      document.body.removeChild(popup);
      pos.classList.remove("livre");

      const rect = pos.getBoundingClientRect();
      const parentRect = aeroporto.getBoundingClientRect();
      const destinoTop = rect.top - parentRect.top + aeroporto.scrollTop + 2;
      const destinoLeft = rect.left - parentRect.left + aeroporto.scrollLeft + 2;

      moverSuave(el, destinoLeft, destinoTop, () => {
        el.style.background = "#1a73e8";
        voo.status = "Estacionado";
        voo.estacionado = true;
        el.dataset.info = JSON.stringify(voo);

        el.onclick = (evt) => {
          evt.stopPropagation();
          selecionarPartida(el, voo);
        };

        adicionarBotaoTrocarPosicao(el);
      });
    };
    popup.appendChild(btnConfirmar);

    const btnCancelar = document.createElement("button");
    btnCancelar.textContent = "Cancelar";
    btnCancelar.style.marginTop = "10px";
    btnCancelar.style.background = "#b22";
    btnCancelar.style.color = "#fff";
    btnCancelar.style.border = "none";
    btnCancelar.style.padding = "8px";
    btnCancelar.style.borderRadius = "8px";
    btnCancelar.style.width = "100%";
    btnCancelar.style.fontWeight = "700";
    btnCancelar.style.cursor = "pointer";
    btnCancelar.onclick = () => document.body.removeChild(popup);
    popup.appendChild(btnCancelar);

    document.body.appendChild(popup);
  }

  function adicionarBotaoTrocarPosicao(el) {
    const idData = el.dataset.info;
    const btnExistente = aeroporto.querySelector(`.btn-trocar-posicao[data-id='${idData}']`);
    if (btnExistente) btnExistente.remove();

    const btn = document.createElement("button");
    btn.className = "btn-trocar-posicao";
    btn.textContent = "Trocar Posição";
    btn.style.position = "absolute";
    btn.style.left = el.style.left;
    btn.style.top = (parseInt(el.style.top, 10) + 38) + "px";
    btn.style.zIndex = 31;
    btn.style.padding = "5px 10px";
    btn.style.fontSize = "12px";
    btn.style.borderRadius = "6px";
    btn.style.cursor = "pointer";
    btn.style.background = "#444";
    btn.style.color = "#fff";
    btn.dataset.id = idData;

    btn.onclick = () => {
      alert("Clique em uma nova posição livre para mover a aeronave.");
      function moverClickHandler(e){
        if(e.target.classList.contains("posicao") && e.target.classList.contains("livre")){
          const novaTop = e.target.offsetTop + e.target.parentElement.offsetTop + aeroporto.scrollTop;
          const novaLeft = e.target.offsetLeft + e.target.parentElement.offsetLeft + aeroporto.scrollLeft;
          el.style.top = novaTop + "px";
          el.style.left = novaLeft + "px";
          e.target.classList.remove("livre");
          btn.style.left = novaLeft + "px";
          btn.style.top = (novaTop + 38) + "px";
          document.removeEventListener("click", moverClickHandler);
        }
      }
      document.addEventListener("click", moverClickHandler);
    };

    aeroporto.appendChild(btn);
  }

  function selecionarPartida(el, voo) {
    const popup = document.createElement("div");
    popup.style.position = "fixed";
    popup.style.top = "50%";
    popup.style.left = "50%";
    popup.style.transform = "translate(-50%, -50%)";
    popup.style.background = "#222";
    popup.style.color = "#fff";
    popup.style.padding = "20px";
    popup.style.border = "2px solid #555";
    popup.style.zIndex = 1001;
    popup.style.maxWidth = "380px";
    popup.style.borderRadius = "12px";
    popup.innerHTML = `<strong>Selecionar Partida para ${voo.voo}</strong><br><br>`;

    const filtro = document.createElement("input");
    filtro.placeholder = "Filtrar por destino ou voo...";
    filtro.style.width = "100%";
    filtro.style.marginBottom = "15px";
    filtro.style.fontSize = "14px";
    popup.appendChild(filtro);

    const select = document.createElement("select");
    select.style.width = "100%";
    select.style.fontSize = "14px";
    popup.appendChild(select);

    function atualizarSelect() {
      select.innerHTML = "";
      const texto = filtro.value.toLowerCase();
      partidas.filter(p => p.status === "Aguardando Associacao" && (
        p.voo.toLowerCase().includes(texto) ||
        p.cidade.toLowerCase().includes(texto) ||
        p.aeronave.toLowerCase().includes(texto)
      )).forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = `${p.voo} - ${p.cidade} - ${p.horario}`;
        select.appendChild(opt);
      });
    }
    filtro.oninput = atualizarSelect;
    atualizarSelect();

    const btnConfirmar = document.createElement("button");
    btnConfirmar.textContent = "Confirmar";
    btnConfirmar.className = "autorizar";
    btnConfirmar.style.marginTop = "15px";
    btnConfirmar.onclick = () => {
      const escolhido = partidas.find(p => p.id === select.value);
      if (escolhido) {
        escolhido.status = "Programado";
        el.title = `Partida para ${escolhido.cidade} ${escolhido.horario}`;
        renderizarPartidas();
      }
      document.body.removeChild(popup);
    };
    popup.appendChild(btnConfirmar);

    const btnCancelar = document.createElement("button");
    btnCancelar.textContent = "Fechar";
    btnCancelar.style.marginTop = "10px";
    btnCancelar.style.background = "#b22";
    btnCancelar.style.color = "#fff";
    btnCancelar.style.border = "none";
    btnCancelar.style.padding = "7px";
    btnCancelar.style.borderRadius = "8px";
    btnCancelar.style.width = "100%";
    btnCancelar.style.fontWeight = "700";
    btnCancelar.style.cursor = "pointer";
    btnCancelar.onclick = () => document.body.removeChild(popup);
    popup.appendChild(btnCancelar);

    document.body.appendChild(popup);
  }

  document.addEventListener("DOMContentLoaded", () => {
    criarTerminais();

    fetch("backup_voos.json")
    .then(r => r.json())
    .then(data => {
      chegadas = data.chegadas.map((v,i) => ({...v, id:"CHG"+i, status:"Aguardando Autorizacao"}));
      partidas = data.partidas.map((v,i) => ({...v, id:"PRT"+i, status:"Aguardando Associacao"}));
      renderizarChegadas();
      renderizarPartidas();
    })
    .catch(() => {
      console.warn("Falha ao carregar dados JSON. Carregando dados de exemplo.");
      chegadas = [
        {id:'CHG0', companhia:'Azul', voo:'AZU1234', cidade:'São Paulo', aeronave:'E190', horario:'14:30', status:'Aguardando Autorizacao'},
        {id:'CHG1', companhia:'Latam', voo:'LAT4321', cidade:'Rio de Janeiro', aeronave:'A320', horario:'15:00', status:'Aguardando Autorizacao'}
      ];
      partidas = [
        {id:'PRT0', companhia:'Azul', voo:'AZU5678', cidade:'Belo Horizonte', aeronave:'E195', horario:'16:00', status:'Aguardando Associacao'},
        {id:'PRT1', companhia:'Latam', voo:'LAT8765', cidade:'Curitiba', aeronave:'A321', horario:'17:30', status:'Aguardando Associacao'}
      ];
      renderizarChegadas();
      renderizarPartidas();
    });

    document.addEventListener("click", (e) => {
      if(e.target.classList.contains("posicao") && e.target.classList.contains("livre")) {
        const aeronavesLaranja = Array.from(document.querySelectorAll(".aeronave")).filter(a => a.style.background === "orange" || a.style.background === "rgb(255, 165, 0)");
        if(aeronavesLaranja.length === 0) return;
        const aeronave = aeronavesLaranja[0];
        const pos = e.target;
        const destinoTop = pos.offsetTop + pos.parentElement.offsetTop + aeroporto.scrollTop;
        const destinoLeft = pos.offsetLeft + pos.parentElement.offsetLeft + aeroporto.scrollLeft;
        moverSuave(aeronave, destinoLeft, destinoTop, () => {
          aeronave.style.background = "#1a73e8";
          pos.classList.remove("livre");
          const vooData = JSON.parse(aeronave.dataset.info);
          vooData.status = "Estacionado";
          aeronave.dataset.info = JSON.stringify(vooData);
          aeronave.onclick = (evt) => {
            evt.stopPropagation();
            selecionarPartida(aeronave, vooData);
          };
        });
      }
    });
  });
</script>
</body>
</html>

```
