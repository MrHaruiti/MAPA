<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Painel de Voos - Aeroporto Hub</title>
  <style>
    /* Reset básico */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
      background: #f0f0f0;
      color: #222;
    }
    #painel {
      width: 320px;
      background: #111;
      color: #fff;
      padding: 15px;
      height: 100vh;
      overflow-y: auto;
      box-shadow: inset -3px 0 10px rgba(0,0,0,0.7);
    }
    #painel h2 {
      margin-top: 0;
      border-bottom: 1px solid #444;
      padding-bottom: 8px;
      font-weight: 600;
      font-size: 1.4em;
    }
    #aeroporto {
      flex: 1;
      background: linear-gradient(90deg, #9cc5e8 0%, #4a7ab7 100%);
      position: relative;
      overflow: auto;
      padding: 20px;
    }
    /* Pista */
    .pista {
      position: absolute;
      top: 50px;
      left: 50px;
      width: 800px;
      height: 30px;
      background: #666;
      border-radius: 8px;
      box-shadow: inset 0 0 10px #444;
      border: 2px solid #444;
      transition: background 0.3s ease;
      z-index: 10;
    }
    /* Terminais */
    .terminal {
      position: absolute;
      width: 360px;
      height: 80px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      background-color: rgba(255 255 255 / 0.9);
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.15);
      border: 1px solid #888;
      padding: 6px;
      user-select: none;
      z-index: 20;
    }
    /* Posições */
    .posicao {
      width: 28px;
      height: 28px;
      background: #ddd;
      border: 1.8px solid #999;
      border-radius: 4px;
      text-align: center;
      line-height: 28px;
      font-size: 14px;
      font-weight: 600;
      color: #555;
      cursor: default;
      transition: background-color 0.25s ease, border-color 0.25s ease;
    }
    .posicao.livre {
      background: #cfc;
      border-color: #484;
      cursor: pointer;
    }
    .posicao.livre:hover {
      background: #af8;
      border-color: #2a2;
    }
    /* Aeronaves */
    .aeronave {
      width: 28px;
      height: 28px;
      background: #1a73e8;
      color: white;
      font-size: 14px;
      text-align: center;
      line-height: 28px;
      border-radius: 6px;
      position: absolute;
      cursor: pointer;
      box-shadow: 0 0 6px #0a5;
      user-select: none;
      transition: background-color 0.3s ease;
      z-index: 30;
    }
    .aeronave[title]:hover {
      filter: brightness(1.2);
    }
    /* Tooltip */
    .tooltip {
      position: absolute;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 6px 10px;
      font-size: 13px;
      border-radius: 8px;
      display: none;
      pointer-events: none;
      z-index: 1000;
    }
    /* Botão Autorizar */
    .autorizar {
      background: #0a0;
      color: #fff;
      border: none;
      padding: 6px 12px;
      cursor: pointer;
      margin-top: 8px;
      border-radius: 6px;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    .autorizar:hover {
      background: #080;
    }
    /* Partida lista */
    .partida-lista, .aeronave-lista {
      background: #222;
      padding: 12px 14px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #444;
      box-shadow: inset 0 0 8px #000;
    }
  </style>
</head>
<body>
  <div id="painel">
    <h2>Chegadas Programadas</h2>
    <div id="chegadas"></div>
    <h2>Partidas Disponíveis</h2>
    <div id="partidas"></div>
  </div>
  <div id="aeroporto" onclick="hideTooltip(event)">
    <div class="pista" title="Pista de pouso"></div>
    <div id="tooltip" class="tooltip"></div>
  </div>

  <script>
    let chegadas = [], partidas = [];
    const chegadasDiv = document.getElementById("chegadas");
    const partidasDiv = document.getElementById("partidas");
    const aeroporto = document.getElementById("aeroporto");
    const tooltip = document.getElementById("tooltip");
    let currentTarget = null;

    // Render chega de voos aguardando autorização
    function renderizarChegadas() {
      chegadasDiv.innerHTML = "";
      chegadas
        .filter(v => v.status === "Aguardando Autorizacao")
        .forEach((v) => {
          const div = document.createElement("div");
          div.className = "aeronave-lista";
          div.innerHTML = `<strong>${v.companhia} ${v.voo}</strong><br>De: ${v.cidade}<br>A/C: ${v.aeronave}<br>Horário: ${v.horario}<br>Status: ${v.status}<br><button class='autorizar'>Autorizar Pouso</button>`;
          div.querySelector("button").onclick = () => autorizarPouso(v);
          chegadasDiv.appendChild(div);
        });
    }

    // Render partidas aguardando associação
    function renderizarPartidas() {
      partidasDiv.innerHTML = "";
      partidas.filter(p => p.status === "Aguardando Associacao").forEach((v) => {
        const div = document.createElement("div");
        div.className = "partida-lista";
        div.innerHTML = `<strong>${v.companhia} ${v.voo}</strong><br>Para: ${v.cidade}<br>A/C: ${v.aeronave}<br>Horário: ${v.horario}<br>Status: ${v.status}`;
        partidasDiv.appendChild(div);
      });
    }

    // Autorizar pouso - animação e criação da aeronave na pista
    function autorizarPouso(voo) {
      voo.status = "Pousando";
      renderizarChegadas();
      const el = document.createElement("div");
      el.className = "aeronave";
      el.innerText = voo.voo;
      el.title = `${voo.companhia} ${voo.voo} - ${voo.cidade}`;
      el.style.top = "50px";
      el.style.left = "60px";
      el.dataset.info = JSON.stringify(voo);
      aeroporto.appendChild(el);
      let left = 60;
      const animar = setInterval(() => {
        left += 3;
        el.style.left = left + "px";
        if (left >= 150) {
          clearInterval(animar);
          voo.status = "Taxiando";
          taxiToTerminal(el, voo);
        }
      }, 20);
      el.onclick = (evt) => { evt.stopPropagation(); selecionarPartida(el, voo); };
    }

    // Taxi até o terminal, escolhe posição disponível
    function taxiToTerminal(el, voo) {
      let top = 50;
      const animarTaxi = setInterval(() => {
        top += 3;
        el.style.top = top + "px";
        if (top >= 250) {
          clearInterval(animarTaxi);
          voo.status = "Aguardando Alocacao";
          el.style.background = "orange";
          el.dataset.info = JSON.stringify(voo);
          escolherPosicaoTerminal(el, voo);
        }
      }, 20);
    }

    // Popup para escolher posição livre nos terminais
    function escolherPosicaoTerminal(el, voo) {
      const popup = document.createElement("div");
      popup.style.position = "fixed";
      popup.style.top = "50%";
      popup.style.left = "50%";
      popup.style.transform = "translate(-50%, -50%)";
      popup.style.background = "#222";
      popup.style.color = "#fff";
      popup.style.padding = "20px";
      popup.style.border = "2px solid #555";
      popup.style.zIndex = 1001;
      popup.innerHTML = "<strong>Escolher posição livre para estacionar</strong><br><br>";

      const select = document.createElement("select");
      select.style.width = "100%";

      const posicoesLivres = Array.from(document.querySelectorAll(".posicao.livre"));
      if (posicoesLivres.length === 0) {
        select.innerHTML = "<option disabled>Nenhuma posição livre disponível</option>";
      } else {
        posicoesLivres.forEach((pos) => {
          const opt = document.createElement("option");
          opt.value = pos.dataset.codigo;
          opt.textContent = pos.dataset.codigo + " (" + pos.dataset.terminal + ")";
          select.appendChild(opt);
        });
      }

      popup.appendChild(select);

      const btnConfirmar = document.createElement("button");
      btnConfirmar.textContent = "Confirmar";
      btnConfirmar.style.marginTop = "10px";
      btnConfirmar.onclick = () => {
        const codigoEscolhido = select.value;
        const pos = Array.from(document.querySelectorAll(".posicao.livre"))
          .find(p => p.dataset.codigo === codigoEscolhido);
        if (!pos) return;

        document.body.removeChild(popup);
        pos.classList.remove("livre");

        // calcular destino relativo ao aeroporto
        const destinoTop = pos.offsetTop + pos.parentElement.offsetTop + aeroporto.scrollTop;
        const destinoLeft = pos.offsetLeft + pos.parentElement.offsetLeft + aeroporto.scrollLeft;

        // animar movimento para posição
        const mover = setInterval(() => {
          const curTop = parseInt(el.style.top);
          const curLeft = parseInt(el.style.left);

          if (Math.abs(curTop - destinoTop) <= 3 && Math.abs(curLeft - destinoLeft) <= 3) {
            clearInterval(mover);
            el.style.top = destinoTop + "px";
            el.style.left = destinoLeft + "px";
            el.style.background = "#1a73e8"; // azul habitual
            voo.status = "Estacionado";
            voo.estacionado = true;
            el.dataset.info = JSON.stringify(voo);

            // clique para selecionar partida
            el.onclick = (evt) => {
              evt.stopPropagation();
              selecionarPartida(el, voo);
            };

            // Botão para trocar posição
            const moverBtn = document.createElement("button");
            moverBtn.textContent = "Trocar Posição";
            moverBtn.style.position = "absolute";
            moverBtn.style.left = el.style.left;
            moverBtn.style.top = (parseInt(el.style.top) + 30) + "px";
            moverBtn.style.zIndex = 40;
            moverBtn.onclick = () => {
              alert("Clique em uma nova posição livre para mover a aeronave.");
              document.addEventListener("click", function moverClick(e2) {
                if (e2.target.classList.contains("posicao") && e2.target.classList.contains("livre")) {
                  const novaTop = e2.target.offsetTop + e2.target.parentElement.offsetTop + aeroporto.scrollTop;
                  const novaLeft = e2.target.offsetLeft + e2.target.parentElement.offsetLeft + aeroporto.scrollLeft;

                  el.style.top = novaTop + "px";
                  el.style.left = novaLeft + "px";
                  e2.target.classList.remove("livre");
                  moverBtn.style.left = novaLeft + "px";
                  moverBtn.style.top = (novaTop + 30) + "px";
                  document.removeEventListener("click", moverClick);
                }
              });
            };
            aeroporto.appendChild(moverBtn);
          } else {
            if (curTop !== destinoTop)
              el.style.top = curTop + Math.sign(destinoTop - curTop) * 3 + "px";
            if (curLeft !== destinoLeft)
              el.style.left = curLeft + Math.sign(destinoLeft - curLeft) * 3 + "px";
          }
        }, 15);
      };
      popup.appendChild(btnConfirmar);

      const cancelar = document.createElement("button");
      cancelar.textContent = "Cancelar";
      cancelar.style.marginLeft = "10px";
      cancelar.onclick = () => document.body.removeChild(popup);
      popup.appendChild(cancelar);

      document.body.appendChild(popup);
    }

    // Selecionar partida - escolher voo para associar a aeronave
    function selecionarPartida(el, voo) {
      const popup = document.createElement("div");
      popup.style.position = "fixed";
      popup.style.top = "50%";
      popup.style.left = "50%";
      popup.style.transform = "translate(-50%, -50%)";
      popup.style.background = "#222";
      popup.style.color = "#fff";
      popup.style.padding = "20px";
      popup.style.border = "2px solid #555";
      popup.style.zIndex = 1001;
      popup.innerHTML = `<strong>Selecionar Partida para ${voo.voo}</strong><br><br>`;

      const filtro = document.createElement("input");
      filtro.placeholder = "Filtrar por destino ou voo...";
      filtro.style.width = "100%";
      filtro.style.marginBottom = "10px";
      popup.appendChild(filtro);

      const select = document.createElement("select");
      select.style.width = "100%";
      popup.appendChild(select);

      function atualizarSelect() {
        select.innerHTML = "";
        const texto = filtro.value.toLowerCase();
        partidas.filter(p => p.status === "Aguardando Associacao" && (
          p.voo.toLowerCase().includes(texto) ||
          p.cidade.toLowerCase().includes(texto) ||
          p.aeronave.toLowerCase().includes(texto)
        )).forEach(p => {
          const opt = document.createElement("option");
          opt.value = p.id;
          opt.textContent = `${p.voo} - ${p.cidade} - ${p.horario}`;
          select.appendChild(opt);
        });
      }

      filtro.oninput = atualizarSelect;
      atualizarSelect();

      const btnConfirmar = document.createElement("button");
      btnConfirmar.textContent = "Confirmar";
      btnConfirmar.style.margin = "10px";
      btnConfirmar.onclick = () => {
        const escolhido = partidas.find(p => p.id === select.value);
        if (escolhido) {
          escolhido.status = "Programado";
          el.title = `Partida para ${escolhido.cidade} ${escolhido.horario}`;
          renderizarPartidas();
        }
        document.body.removeChild(popup);
      };
      popup.appendChild(btnConfirmar);

      const cancelar = document.createElement("button");
      cancelar.textContent = "Fechar";
      cancelar.onclick = () => document.body.removeChild(popup);
      popup.appendChild(cancelar);

      document.body.appendChild(popup);
    }

    // Esconder tooltip se clicar fora
    function hideTooltip(e) {
      if (e.target !== currentTarget && !tooltip.contains(e.target)) {
        tooltip.style.display = "none";
        currentTarget = null;
      }
    }

    // Criar os terminais com suas posições
    function criarTerminais() {
      const totalTerminais = 10;
      const posicoesPorTerminal = 36;
      for (let t = 0; t < totalTerminais; t++) {
        const term = document.createElement("div");
        term.className = "terminal";
        const isTopo = t < 5;
        term.style.top = isTopo ? "100px" : "600px";
        term.style.left = (100 + (t % 5) * 400) + "px";
        // Criar posições
        for (let p = 1; p <= posicoesPorTerminal; p++) {
          const pos = document.createElement("div");
          pos.className = "posicao livre";
          const posicaoNum = ((t + 1) * 100) + p;
          pos.dataset.terminal = "TPS" + (t + 1);
          pos.dataset.portao = posicaoNum;
          pos.dataset.codigo = posicaoNum;
          pos.innerText = posicaoNum;
          term.appendChild(pos);
        }
        aeroporto.appendChild(term);
      }
    }

    // Carregar dados e iniciar
    document.addEventListener("DOMContentLoaded", () => {
      criarTerminais();

      // Substituir URL abaixo pelo seu JSON de dados real
      fetch("backup_voos.json")
        .then(r => r.json())
        .then(data => {
          chegadas = data.chegadas.map((v, i) => ({...v, id: "CHG" + i, status: "Aguardando Autorizacao"}));
          partidas = data.partidas.map((v, i) => ({...v, id: "PRT" + i, status: "Aguardando Associacao"}));
          renderizarChegadas();
          renderizarPartidas();
        })
        .catch(() => {
          // Caso não consiga carregar o JSON, pode-se usar dados fixos para teste
          console.warn("Falha ao carregar backup_voos.json, carregando dados estáticos de teste.");
          chegadas = [
            {id:'CHG0', companhia:'Azul', voo:'AZU1234', cidade:'São Paulo', aeronave:'E190', horario:'14:30', status:'Aguardando Autorizacao'},
            {id:'CHG1', companhia:'Latam', voo:'LAT4321', cidade:'Rio de Janeiro', aeronave:'A320', horario:'15:00', status:'Aguardando Autorizacao'}
          ];
          partidas = [
            {id:'PRT0', companhia:'Azul', voo:'AZU5678', cidade:'Belo Horizonte', aeronave:'E195', horario:'16:00', status:'Aguardando Associacao'},
            {id:'PRT1', companhia:'Latam', voo:'LAT8765', cidade:'Curitiba', aeronave:'A321', horario:'17:30', status:'Aguardando Associacao'}
          ];
          renderizarChegadas();
          renderizarPartidas();
        });

      // Clique para estacionar aeronave em posição livre (usar para troca de posição)
      document.addEventListener("click", (e) => {
        if (e.target.classList.contains("posicao") && e.target.classList.contains("livre")) {
          const aeronavesTaxiando = Array.from(document.querySelectorAll(".aeronave")).filter(a => a.style.background === "orange" || a.style.background === "rgb(255, 165, 0)"); // laranja em rgb
          if (aeronavesTaxiando.length === 0) return;
          const aeronave = aeronavesTaxiando[0];
          const pos = e.target;
          const destinoTop = pos.offsetTop + pos.parentElement.offsetTop + aeroporto.scrollTop;
          const destinoLeft = pos.offsetLeft + pos.parentElement.offsetLeft + aeroporto.scrollLeft;
          aeronave.style.top = destinoTop + "px";
          aeronave.style.left = destinoLeft + "px";
          aeronave.style.background = "#1a73e8"; // azul
          pos.classList.remove("livre");
          // Atualizar voo para "Estacionado"
          const voo = JSON.parse(aeronave.dataset.info);
          voo.status = "Estacionado";
          aeronave.dataset.info = JSON.stringify(voo);
          // Clique para selecionar partida
          aeronave.onclick = (evt) => {
            evt.stopPropagation();
            selecionarPartida(aeronave, voo);
          };
        }
      });
    });
  </script>
</body>
</html>


