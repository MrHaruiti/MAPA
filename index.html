<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel de Voos - Aeroporto Hub</title>
  <style>
    body { margin: 0; font-family: sans-serif; display: flex; }
    #painel { width: 320px; background: #111; color: #fff; padding: 10px; height: 100vh; overflow-y: auto; }
    #aeroporto { flex: 1; background: #eee; position: relative; overflow: auto; }
    .aeronave-lista, .partida-lista {
      background: #222; padding: 8px; margin-bottom: 6px; border: 1px solid #444;
    }
    .autorizar, .atribuir { background: #0a0; color: #fff; border: none; padding: 5px; cursor: pointer; margin-top: 5px; }
    .pista { position: absolute; top: 50px; left: 50px; width: 800px; height: 30px; background: gray; }
    .terminal { position: absolute; width: 360px; display: flex; flex-wrap: wrap; }
    .posicao { width: 20px; height: 20px; margin: 2px; background: #ccc; border: 1px solid #999; position: relative; }
    .posicao.livre:hover { background: #8f8; cursor: pointer; }
    .aeronave { width: 20px; height: 20px; background: blue; color: white; font-size: 10px; text-align: center; line-height: 20px; position: absolute; }
    .tooltip { position: absolute; background: black; color: white; padding: 5px; font-size: 12px; display: none; z-index: 1000; }
  </style>
</head>
<body>
  <div id="painel">
    <h2>Chegadas Programadas</h2>
    <div id="chegadas"></div>
    <h2>Partidas Disponíveis</h2>
    <div id="partidas"></div>
  </div>
  <div id="aeroporto" onclick="hideTooltip(event)">
    <div class="pista"></div>
    <div id="tooltip" class="tooltip"></div>
  </div>

  <script>
    let chegadas = [], partidas = [], contadorAeronaves = 0, currentTarget = null;
    const chegadasDiv = document.getElementById("chegadas");
    const partidasDiv = document.getElementById("partidas");
    const aeroporto = document.getElementById("aeroporto");
    const tooltip = document.getElementById("tooltip");

    async function carregarVoos() {
      const resp = await fetch("backup_voos (4).json");
      const data = await resp.json();
      chegadas = data.chegadas.map((v, i) => ({...v, id: "CHG" + i, status: "Aguardando Autorizacao"}));
      partidas = data.partidas.map((v, i) => ({...v, id: "PRT" + i, status: "Aguardando Associacao"}));
      renderizarChegadas();
      renderizarPartidas();
    }

    function renderizarChegadas() {
      chegadasDiv.innerHTML = "";
      chegadas.forEach((v) => {
        const div = document.createElement("div");
        div.className = "aeronave-lista";
        div.innerHTML = `<strong>${v.companhia} ${v.voo}</strong><br>De: ${v.cidade}<br>A/C: ${v.aeronave}<br>Horário: ${v.horario}<br>Status: ${v.status}<br><button class='autorizar'>Autorizar Pouso</button>`;
        div.querySelector("button").onclick = () => autorizarPouso(v);
        chegadasDiv.appendChild(div);
      });
    }

    function renderizarPartidas() {
      partidasDiv.innerHTML = "";
      partidas.filter(p => p.status === "Aguardando Associacao").forEach((v) => {
        const div = document.createElement("div");
        div.className = "partida-lista";
        div.innerHTML = `<strong>${v.companhia} ${v.voo}</strong><br>Para: ${v.cidade}<br>A/C: ${v.aeronave}<br>Horário: ${v.horario}<br>Status: ${v.status}`;
        partidasDiv.appendChild(div);
      });
    }

    function autorizarPouso(voo) {
      voo.status = "Pousando";
      renderizarChegadas();
      const el = document.createElement("div");
      el.className = "aeronave";
      el.innerText = voo.voo;
      el.style.top = "50px";
      el.style.left = "60px";
      el.dataset.info = JSON.stringify(voo);
      aeroporto.appendChild(el);
      let left = 60;
      const animar = setInterval(() => {
        left += 2;
        el.style.left = left + "px";
        if (left >= 150) {
          clearInterval(animar);
          voo.status = "Taxiando";
          taxiToTerminal(el, voo);
        }
      }, 20);
      el.onclick = (evt) => { evt.stopPropagation(); showTooltip(el); };
    }

    function taxiToTerminal(el, voo) {
      let top = 50;
      const animarTaxi = setInterval(() => {
        top += 2;
        el.style.top = top + "px";
        if (top >= 250) {
          clearInterval(animarTaxi);
          voo.status = "Estacionado";
          selecionarPartida(el, voo);
        }
      }, 20);
    }

    function selecionarPartida(el, voo) {
      const opcoes = partidas.filter(p => p.companhia === voo.companhia && p.status === "Aguardando Associacao");
      if (opcoes.length === 0) return alert("Sem voos disponíveis desta companhia.");
      const escolha = prompt("Escolha o destino:", opcoes.map(o => `${o.voo} - ${o.cidade}`).join(", "));
      const escolhido = opcoes.find(o => escolha && escolha.includes(o.voo));
      if (!escolhido) return;
      escolhido.status = "Programado";
      el.title = `Partida para ${escolhido.cidade} ${escolhido.horario}`;
      renderizarPartidas();
    }

    function showTooltip(target) {
      const info = JSON.parse(target.dataset.info);
      currentTarget = target;
      tooltip.innerHTML = `<strong>${info.companhia} ${info.voo}</strong><br>Status: ${info.status}`;
      tooltip.style.display = "block";
      tooltip.style.top = (target.offsetTop + 25) + "px";
      tooltip.style.left = (target.offsetLeft + 25) + "px";
    }

    function hideTooltip(e) {
      if (e.target !== currentTarget && !tooltip.contains(e.target)) {
        tooltip.style.display = "none";
        currentTarget = null;
      }
    }

    carregarVoos();
  </script>
</body>
</html>
